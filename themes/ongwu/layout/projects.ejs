<!-- 页面标题设置 -->
<% page.title = '项目作品' %>

<div class="container">
    <div class="page-header">
        <h1 class="page-title">
            项目作品
        </h1>
        <p class="page-description">展示我的项目作品和技术实践</p>
    </div>
    
    <div class="projects-grid" id="projectsGrid">
        <% 
        var projectPosts = site.posts.filter(function(post) {
            return post.categories && post.categories.some(function(cat) {
                return cat.name === 'projects';
            });
        });
        %>
        
        <% projectPosts.each(function(post) { %>
        <div class="project-card" data-post="true">
            <div class="project-preview">
                <% if (post.thumbnail) { %>
                    <img src="<%- post.thumbnail %>" alt="<%- post.title %>" class="project-image">
                <% } else { %>
                    <div class="project-placeholder">
                        <div class="device-mockup">
                            <div class="desktop"></div>
                            <div class="tablet"></div>
                            <div class="mobile"></div>
                        </div>
                    </div>
                <% } %>
            </div>
            <div class="project-info">
                <h3 class="project-title">
                    <a href="<%- config.root %><%- post.path %>"><%- post.title %></a>
                </h3>
                <p class="project-description"><%- post.description || post.excerpt %></p>
            </div>
        </div>
        <% }); %>
    </div>
    
    <!-- 分页导航 -->
    <div class="pagination-wrapper" id="projectsPagination" style="display: none;">
        <div class="pagination" id="projectsPaginationNav">
            <!-- 分页按钮将通过JavaScript动态生成 -->
        </div>
        
        <div class="pagination-info" id="projectsPaginationInfo">
            <!-- 分页信息将通过JavaScript动态生成 -->
        </div>
    </div>
</div>

<script>
// 项目作品页面分页功能
(function() {
    const postsPerPage = 20;
    const grid = document.getElementById('projectsGrid');
    const pagination = document.getElementById('projectsPagination');
    const paginationNav = document.getElementById('projectsPaginationNav');
    const paginationInfo = document.getElementById('projectsPaginationInfo');
    
    if (!grid) return;
    
    const posts = Array.from(grid.querySelectorAll('[data-post="true"]'));
    const totalPosts = posts.length;
    const totalPages = Math.ceil(totalPosts / postsPerPage);
    
    // 总是显示分页，即使只有一页
    pagination.style.display = 'block';
    
    // 声明当前页变量（使用window对象使其全局可访问）
    window.currentProjectsPage = 1;
    
    if (totalPages <= 1) {
        // 如果只有一页，显示所有项目
        posts.forEach(post => post.style.display = 'block');
        paginationInfo.innerHTML = `共 ${totalPosts} 个项目`;
        // 即使只有一页，也生成分页导航（显示页码1）
        generatePagination();
        return;
    }
    
    // 隐藏所有项目
    posts.forEach(post => post.style.display = 'none');
    
    // 显示第一页
    showPage(1);
    
    // 生成分页导航
    generatePagination();
    
    function showPage(pageNum) {
        const start = (pageNum - 1) * postsPerPage;
        const end = start + postsPerPage;
        
        posts.forEach((post, index) => {
            post.style.display = (index >= start && index < end) ? 'block' : 'none';
        });
        
        updatePaginationInfo(pageNum);
    }
    
    function generatePagination() {
        let html = '';
        
        // 上一页按钮
        if (window.currentProjectsPage === 1) {
            html += '<button class="page-btn prev-page" disabled>';
            html += '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">';
            html += '<path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            html += '</svg>上一页</button>';
        } else {
            html += '<button class="page-btn prev-page" onclick="changeProjectsPage(window.currentProjectsPage - 1)">';
            html += '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">';
            html += '<path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            html += '</svg>上一页</button>';
        }
        
        // 页码按钮
        for (let i = 1; i <= totalPages; i++) {
            if (i === window.currentProjectsPage) {
                html += '<span class="page-btn current-page">' + i + '</span>';
            } else {
                html += '<button class="page-btn" onclick="changeProjectsPage(' + i + ')">' + i + '</button>';
            }
        }
        
        // 下一页按钮
        if (window.currentProjectsPage === totalPages) {
            html += '<button class="page-btn next-page" disabled>';
            html += '下一页<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">';
            html += '<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            html += '</svg></button>';
        } else {
            html += '<button class="page-btn next-page" onclick="changeProjectsPage(window.currentProjectsPage + 1)">';
            html += '下一页<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">';
            html += '<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            html += '</svg></button>';
        }
        
        paginationNav.innerHTML = html;
    }
    
    function updatePaginationInfo(pageNum) {
        paginationInfo.innerHTML = `第 ${pageNum} 页，共 ${totalPages} 页，总计 ${totalPosts} 个项目`;
    }
    
    let currentProjectsPage = 1;
    
    window.changeProjectsPage = function(pageNum) {
        if (pageNum < 1 || pageNum > totalPages) return;
        
        window.currentProjectsPage = pageNum;
        showPage(pageNum);
        
        // 重新生成分页导航以更新按钮状态
        generatePagination();
        
        // 滚动到顶部
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };
})();
</script>
