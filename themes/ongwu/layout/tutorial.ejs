<!-- é¡µé¢æ ‡é¢˜è®¾ç½® -->
<% page.title = 'æ•™ç¨‹åˆ†äº«' %>

<div class="container">
    <div class="page-header">
        <h1 class="page-title">
            æ•™ç¨‹åˆ†äº«
        </h1>
        <p class="page-description">åˆ†äº«å®ç”¨çš„æŠ€æœ¯æ•™ç¨‹å’Œå­¦ä¹ å¿ƒå¾—</p>
    </div>
    
    <div class="tutorial-grid" id="tutorialGrid">
        <% 
        var tutorialPosts = site.posts.filter(function(post) {
            return post.categories && post.categories.some(function(cat) {
                return cat.name === 'tutorial';
            });
        });
        %>
        
        <% tutorialPosts.each(function(post) { %>
        <div class="tutorial-item" data-post="true">
            <div class="tutorial-icon">
                <% if (post.icon) { %>
                    <img src="<%- post.icon %>" alt="<%- post.title %>">
                <% } else { %>
                    <div class="default-icon">ğŸ“š</div>
                <% } %>
            </div>
            <div class="tutorial-content">
                <h3 class="tutorial-title">
                    <a href="<%- config.root %><%- post.path %>"><%- post.title %></a>
                </h3>
                <p class="tutorial-subtitle"><%- post.subtitle || post.description || post.excerpt %></p>
                <div class="tutorial-meta">
                    <span class="tutorial-date"><%- date(post.date, 'YYYY-MM-DD') %></span>
                    <% if (post.tags && post.tags.length > 0) { %>
                        <div class="tutorial-tags">
                            <% 
                            var tagCount = 0;
                            post.tags.each(function(tag) {
                                if (tagCount < 2) {
                            %>
                                <a href="<%- config.root %>tags/<%- tag.name %>/" class="tag"><%- tag.name %></a>
                            <%
                                    tagCount++;
                                }
                            });
                            %>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        <% }); %>
    </div>
    
    <!-- åˆ†é¡µå¯¼èˆª -->
    <div class="pagination-wrapper" id="tutorialPagination" style="display: none;">
        <div class="pagination" id="tutorialPaginationNav">
            <!-- åˆ†é¡µæŒ‰é’®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div class="pagination-info" id="tutorialPaginationInfo">
            <!-- åˆ†é¡µä¿¡æ¯å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </div>
    </div>
</div>

<script>
// æ•™ç¨‹åˆ†äº«é¡µé¢åˆ†é¡µåŠŸèƒ½
(function() {
    const postsPerPage = 21;
    const grid = document.getElementById('tutorialGrid');
    const pagination = document.getElementById('tutorialPagination');
    const paginationNav = document.getElementById('tutorialPaginationNav');
    const paginationInfo = document.getElementById('tutorialPaginationInfo');
    
    if (!grid) return;
    
    const posts = Array.from(grid.querySelectorAll('[data-post="true"]'));
    const totalPosts = posts.length;
    const totalPages = Math.ceil(totalPosts / postsPerPage);
    
    // æ€»æ˜¯æ˜¾ç¤ºåˆ†é¡µï¼Œå³ä½¿åªæœ‰ä¸€é¡µ
    pagination.style.display = 'block';
    
    // å£°æ˜å½“å‰é¡µå˜é‡ï¼ˆä½¿ç”¨windowå¯¹è±¡ä½¿å…¶å…¨å±€å¯è®¿é—®ï¼‰
    window.currentTutorialPage = 1;
    
    if (totalPages <= 1) {
        // å¦‚æœåªæœ‰ä¸€é¡µï¼Œæ˜¾ç¤ºæ‰€æœ‰æ–‡ç« 
        posts.forEach(post => post.style.display = 'block');
        paginationInfo.innerHTML = `å…± ${totalPosts} ç¯‡æ–‡ç« `;
        // å³ä½¿åªæœ‰ä¸€é¡µï¼Œä¹Ÿç”Ÿæˆåˆ†é¡µå¯¼èˆªï¼ˆæ˜¾ç¤ºé¡µç 1ï¼‰
        generatePagination();
        return;
    }
    
    // éšè—æ‰€æœ‰æ–‡ç« 
    posts.forEach(post => post.style.display = 'none');
    
    // æ˜¾ç¤ºç¬¬ä¸€é¡µ
    showPage(1);
    
    // ç”Ÿæˆåˆ†é¡µå¯¼èˆª
    generatePagination();
    
    function showPage(pageNum) {
        const start = (pageNum - 1) * postsPerPage;
        const end = start + postsPerPage;
        
        posts.forEach((post, index) => {
            post.style.display = (index >= start && index < end) ? 'block' : 'none';
        });
        
        updatePaginationInfo(pageNum);
    }
    
    function generatePagination() {
        let html = '';
        
        // ä¸Šä¸€é¡µæŒ‰é’®
        if (window.currentTutorialPage === 1) {
            html += '<button class="page-btn prev-page" disabled>';
            html += '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">';
            html += '<path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            html += '</svg>ä¸Šä¸€é¡µ</button>';
        } else {
            html += '<button class="page-btn prev-page" onclick="changeTutorialPage(window.currentTutorialPage - 1)">';
            html += '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">';
            html += '<path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            html += '</svg>ä¸Šä¸€é¡µ</button>';
        }
        
        // é¡µç æŒ‰é’®
        for (let i = 1; i <= totalPages; i++) {
            if (i === window.currentTutorialPage) {
                html += '<span class="page-btn current-page">' + i + '</span>';
            } else {
                html += '<button class="page-btn" onclick="changeTutorialPage(' + i + ')">' + i + '</button>';
            }
        }
        
        // ä¸‹ä¸€é¡µæŒ‰é’®
        if (window.currentTutorialPage === totalPages) {
            html += '<button class="page-btn next-page" disabled>';
            html += 'ä¸‹ä¸€é¡µ<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">';
            html += '<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            html += '</svg></button>';
        } else {
            html += '<button class="page-btn next-page" onclick="changeTutorialPage(window.currentTutorialPage + 1)">';
            html += '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">';
            html += '<path d="M9 18L15 12L9 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>';
            html += '</svg></button>';
        }
        
        paginationNav.innerHTML = html;
    }
    
    function updatePaginationInfo(pageNum) {
        paginationInfo.innerHTML = `ç¬¬ ${pageNum} é¡µï¼Œå…± ${totalPages} é¡µï¼Œæ€»è®¡ ${totalPosts} ç¯‡æ–‡ç« `;
    }
    
    let currentTutorialPage = 1;
    
    window.changeTutorialPage = function(pageNum) {
        if (pageNum < 1 || pageNum > totalPages) return;
        
        window.currentTutorialPage = pageNum;
        showPage(pageNum);
        
        // é‡æ–°ç”Ÿæˆåˆ†é¡µå¯¼èˆªä»¥æ›´æ–°æŒ‰é’®çŠ¶æ€
        generatePagination();
        
        // æ»šåŠ¨åˆ°é¡¶éƒ¨
        window.scrollTo({ top: 0, behavior: 'smooth' });
    };
})();
</script>
